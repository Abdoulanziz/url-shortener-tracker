<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/svg/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/icons/themify-icons.css" />
    <link rel="stylesheet" href="/css/utils.css" />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/responsive.css" />
    <title>URLs</title>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="container hide" id="web-view">
          <div class="navbar-nav flex">
            <img src="/svg/logo.svg" alt="Logo" class="navbar-logo" />
            <nav>
              <ul class="flex">
                <li><a href="/">Home</a></li>
                <li><a href="/urls">URLs</a></li>
                <li><a href="/docs">Docs</a></li>
              </ul>
            </nav>
          </div>
        </div>
        <div class="container" id="mob-view">
          <div class="navbar-nav flex" style="justify-content: space-between;">
            <div class="flex" style="gap: .4rem;">
              <img src="/svg/logo.svg" alt="Logo" class="navbar-logo" />
              <span class="navbar-logo-text">Linkdash</span>
            </div>
            <img src="/svg/menu-open.svg" alt="Menu" class="navbar-menu-button" id="menu-button-open" />
            <img src="/svg/menu-close.svg" alt="Menu" class="navbar-menu-button hide" id="menu-button-close" />
          </div>
          <div class="navbar-dropdown hide">
            <div class="dropdown-items">
              <div class="dropdown-item">
                <span class="title flex"><span>Home</span></span>
              </div>
              <div class="dropdown-item">
                <span class="title flex"><span>URLs</span></span>
              </div>
              <div class="dropdown-item">
                <span class="title flex"><span>Docs</span></span>
              </div>
              <% if(data.sid){ %>
                <div class="dropdown-item-x flex">
                  <a
                    href="/signout"
                    class="btn auth-btn-signup flex"
                    >Signout</a
                  >
                </div>
              <% }else{ %>
                <div class="dropdown-item-x flex" style="flex-direction: column">
                  <a
                    href="/signin"
                    class="btn auth-btn-signin flex"
                    >Signin</a
                  >
                  <a
                    href="/signup"
                    class="btn auth-btn-signup flex"
                    >Signup</a
                  >
                </div>
              <% }%>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <main>
      <div class="container flex" style="align-items: flex-start;justify-content: flex-start;"> 
        <div style="inline-size: 100%;">
            <h3 style="margin-block-start: 1.4em;">My Short URLs</h3>
            <ol class="urls">
              <% if(data.result){ %>
                <% data.result.forEach((r, i) => { %>
                  <li class="url-item" style="background-color:var(--primary-color);">
                    <div class="url-card" style="inline-size: 100%;">
                      <div class="url-target-stats">
                        <div class="flex" style="justify-content: space-between;">
                          <h4 class="url-target">Target: <%= r.urlTarget %></h4>
                          <img src="/svg/delete.svg" alt="Delete icon" style="inline-size: 20px;block-size: 20px;cursor: pointer;">
                        </div>
                        <a href="/stats/<%= `${r._id}` %>" class="url-stats">Go to stats <i class="ti-arrow-right"></i></a>
                      </div>
                      <div class="flex" style="justify-content: space-between;">
                        <span class="url-string">URL: <span class="url" style="color:#1da1f2;" data-url="https://<%= r.urlNew %>" id="url-<%= i %>">https://<%= r.urlNew %></span></span>
                        <div class="flex">
                          <span style="font-size: 11px;color: #b0aeae;">Copy</span>
                          <img class="copy-btn" data-copy="url-<%= i %>" src="/svg/copy.png" alt="Copy to clipboard" style="inline-size: 20px;block-size: 20px;cursor: pointer;margin-inline-start: .6em;" >
                        </div>
                      </div>
                    </div>
                  </li>
                <% }) %>
              <% }else if(data == ""){ %>
                <div style="padding:.6em .8em; background-color:var(--primary-color);border-radius:4px;">
                    <h4>Oops!</h4>
                    <h6>No URLs created - yet.</h6>     
                </div>
              <% }%>
              </ol>
        </div>
      </div>
    </main>
    <footer>
      <!-- <div class="container flex">
        <ul>
          <li class="flex"><a href="#">Features</a></li>
          <li class="flex"><a href="#">Privacy policy</a></li>
          <li class="flex"><a href="#">Terms of service</a></li>
        </ul>
      </div> -->
    </footer>
  <script src="/js/main.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", event => {
      // Format label
      const uiURLLabels = document.querySelectorAll(".url");
      uiURLLabels.forEach(uiURLLabel => formatLabel(38, uiURLLabel));

      const copyBtns = document.querySelectorAll(".copy-btn");
      copyBtns.forEach(copyBtn => copyBtn.addEventListener("click", event => {
        const copyTextID = event.target.dataset.copy;
        const copyTextElement = document.querySelector(`#${copyTextID}`);

        const textToCopy = copyTextElement.dataset.url;
        navigator.clipboard.writeText(textToCopy)
          .then(() => {
            copyTextElement.parentElement.nextElementSibling.firstElementChild.textContent = "Copied";
            copyTextElement.parentElement.nextElementSibling.firstElementChild.style.color = "#fff";

            setTimeout(() => {
              copyTextElement.parentElement.nextElementSibling.firstElementChild.textContent = "Copy";
              copyTextElement.parentElement.nextElementSibling.firstElementChild.style.color = "#b0aeae";
            }, 2000);
          })
          .catch(error => {
            console.log("Unable to copy: ", error);
          });
      }));
    });

  </script>
  </body>
</html>
